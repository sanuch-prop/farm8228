<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>–ê–∫—Ç—É–∞–ª—å–Ω–∞—è ‚Äî RideNow</title>
  <style>
    :root{
      --ink:#eaf2ff; --muted:#a6b5cc; --stroke:rgba(255,255,255,.18);
      --glass-1:rgba(14,21,26,.55); --glass-2:rgba(14,21,26,.35);
      --g1:#ffb668; --g2:#9de9d7;
      --gutter:16px; --gap-bottom:12px; --nav-h:92px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:
        linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.55) 35%, rgba(0,0,0,.45) 60%, rgba(0,0,0,.55)),
        url("image.png") center/cover no-repeat fixed;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      padding:var(--gutter);
      padding-bottom:calc(var(--gutter) + env(safe-area-inset-bottom));
      display:flex; flex-direction:column; overflow:hidden;
    }

    main.card{
      width:min(760px, calc(100vw - var(--gutter)*2));
      margin:0 auto;
      border-radius:22px; border:1px solid var(--stroke);
      background:linear-gradient(180deg,var(--glass-1),var(--glass-2));
      box-shadow:0 30px 80px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.22);
      backdrop-filter: blur(16px) saturate(140%);
      max-height:calc(100dvh - var(--nav-h) - var(--gap-bottom) - env(safe-area-inset-bottom));
      overflow:auto; -webkit-overflow-scrolling:touch;
    }
    .inner{ padding:16px 16px 18px }

    .brand{font-weight:900;display:flex;gap:8px;align-items:center;opacity:.95}
    .brand .dot{width:8px;height:8px;border-radius:50%;background:#58e0ff}
    h1{margin:8px 0 12px;font-size:26px;letter-spacing:.2px}
    .section-title{font-weight:900;margin:12px 6px 8px}

    /* –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .r-card{
      border-radius:20px; overflow:hidden;
      background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.18);
      box-shadow:0 20px 50px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.15);
      backdrop-filter:blur(12px) saturate(140%);
      padding:14px 12px; margin-bottom:12px;
    }
    .r-top{display:flex; gap:10px; align-items:flex-start; justify-content:space-between}
    .r-route{font-weight:900; font-size:20px}
    .right{display:flex; gap:8px; align-items:center}
    .badge{
      padding:6px 10px; border-radius:12px; font-weight:900; font-size:13px;
      border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.08)
    }
    .badge.price{color:#072e12; background:linear-gradient(90deg,#ffb668,#9de9d7); border:0}
    .badge.pending{color:#ffd59b; border-color:rgba(255,213,155,.35); background:rgba(255,213,155,.12)}
    .badge.ok{color:#0cffa6; border-color:rgba(157,233,215,.45); background:rgba(157,233,215,.10)}
    .badge.warn{color:#ffb668; border-color:rgba(255,182,104,.45); background:rgba(255,182,104,.10)}
    .badge.err{color:#ff8a8a; border-color:rgba(255,138,138,.45); background:rgba(255,138,138,.10)}
    .r-row{display:flex; gap:12px; color:#a6b5cc; font-size:14px; margin:6px 0 10px}
    .r-driver{display:flex; gap:12px; align-items:center}
    .r-ava{width:42px;height:42px;border-radius:50%;overflow:hidden;background:#777;flex-shrink:0}
    .r-ava img{width:100%;height:100%;object-fit:cover}
    .r-info{flex:1}
    .r-name{display:flex;align-items:center;gap:6px;font-weight:800}
    .r-ver{font-size:12px;padding:2px 6px;border-radius:8px;background:linear-gradient(90deg,#ffb668,#9de9d7);color:#0b0f12;font-weight:800}
    .r-car{color:#a6b5cc;font-size:14px}

    /* —Å—Å—ã–ª–∫–∞-–∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π –±—Ä–æ–Ω–∏ */
    .link-card{display:block; color:inherit; text-decoration:none}

    /* –∏—Å—Ç–æ—Ä–∏—è */
    .history .r-card{padding:12px}
    .sub{color:#9fb0c9; font-size:13px; margin-top:2px}

    /* ===== –®—Ç–æ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ ===== */
    .sheet{
      position:fixed; left:0; right:0; bottom:-100%;
      margin:auto; width:min(760px,96vw); z-index:1002;
      border:1px solid var(--stroke); border-radius:16px 16px 0 0;
      background:linear-gradient(180deg, rgba(20,24,32,.92), rgba(20,24,32,.88));
      box-shadow:0 -30px 80px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.22);
      backdrop-filter: blur(16px) saturate(160%);
      transition:bottom .22s ease, transform .22s ease;
      transform:translateY(12px);
      padding-bottom:calc(82px + env(safe-area-inset-bottom));
    }
    .sheet.open{ bottom:0; transform:translateY(0) }
    .sheet .grip{ width:48px;height:5px;border-radius:999px;background:rgba(255,255,255,.25); margin:8px auto }
    .sheet .body{ padding:10px 12px 16px }
    .d-card{border-radius:18px;border:1px solid var(--stroke);
      background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.06)); padding:14px}
    .d-top{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .d-title{font-weight:900;font-size:20px}
    .close{height:40px;min-width:40px;border-radius:12px;border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06)); color:var(--ink); font-weight:900; cursor:pointer}
    .d-row{display:flex;gap:12px;color:#a6b5cc;font-size:14px;margin:8px 0}
    .photos{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
    .ph{height:90px;border-radius:12px;overflow:hidden;background:#222}
    .ph img{width:100%;height:100%;object-fit:cover;border-radius:12px}

    /* –Ω–∞–≤–∏–≥–∞—Ü–∏—è: —Å–ª–µ–≤–∞ –ü—Ä–æ—Ñ–∏–ª—å, —Å–ø—Ä–∞–≤–∞ –ü–æ–∏—Å–∫ */
    .bottom-shell{position:fixed;left:0;right:0;bottom:0;z-index:1001;
      padding:0 env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
    .bottom-bar{display:flex;justify-content:space-around;background:var(--glass-2);
      border-radius:20px 20px 0 0;padding:8px;backdrop-filter:blur(12px)}
    .bn-tab{flex:1;text-align:center;color:var(--ink);font-size:12px;text-decoration:none;padding:6px 0}
    .bn-tab .ico{font-size:18px;display:block}
    .bn-tab.active{color:var(--g1)}

    /* –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
    .empty{
      border:1px dashed rgba(255,255,255,.25);
      border-radius:16px; padding:14px; text-align:center;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      color:#cfe3ff; font-weight:800
    }
  </style>
</head>
<body>
  <main class="card" id="card">
    <div class="inner">
      <div class="brand"><span class="dot"></span><span>RideNow</span></div>
      <h1>–ê–∫—Ç—É–∞–ª—å–Ω–∞—è</h1>

      <!-- –¢–ï–ö–£–©–ê–Ø –ë–†–û–ù–¨ (–¥–∏–Ω–∞–º–∏—á–Ω–æ) -->
      <div class="section-title">–¢–µ–∫—É—â–∞—è –±—Ä–æ–Ω—å</div>
      <a class="r-card link-card" id="currentCard" href="passenger-trip-pending.html" aria-label="–û—Ç–∫—Ä—ã—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–µ–∑–¥–∫—É">
        <div class="r-top">
          <div class="r-route" id="routeText">–ö–∏–µ–≤ ‚Üí –û–¥–µ—Å—Å–∞</div>
          <div class="right">
            <span class="badge price" id="priceBadge">550 ‚Ç¥</span>
            <span class="badge pending" id="statusBadge">–û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</span>
          </div>
        </div>
        <div class="r-row">
          <span>‚è∞ <span id="timeText">08:30 ‚Üí 13:15</span></span>
          <span>üõ£Ô∏è <span id="distText">475 –∫–º</span></span>
          <span>üìÖ <span id="dateText">16.09.2025</span></span>
        </div>
        <div class="r-driver">
          <div class="r-ava"><img src="https://images.unsplash.com/photo-1599566150163-29194dcaad36?w=200" alt=""></div>
          <div class="r-info">
            <div class="r-name">–ü–∞–≤–µ–ª <span class="r-ver">‚úì</span></div>
            <div class="r-car">Toyota Camry</div>
          </div>
        </div>
      </a>
      <div class="empty" id="emptyState" style="display:none">
        –í—ã –µ—â—ë –Ω–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –ø–æ–µ–∑–¥–∫–µ.<br>–ü–æ—Å–ª–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –≤–∞—à–∞ —Ç–µ–∫—É—â–∞—è –±—Ä–æ–Ω—å.
        <div style="margin-top:10px">
          <a class="badge" href="passenger-search.html">–ò—Å–∫–∞—Ç—å –ø–æ–µ–∑–¥–∫—É</a>
        </div>
      </div>

      <!-- –ò–°–¢–û–†–ò–Ø: –û–¢–ö–†–´–í–ê–ï–¢–°–Ø –®–¢–û–†–ö–û–ô –° 3 –§–û–¢–û -->
      <div class="section-title">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–µ–∑–¥–æ–∫</div>
      <section class="history" id="history">
        <div class="r-card hist"
             data-from="–õ—å–≤–æ–≤" data-to="–ñ–∏—Ç–æ–º–∏—Ä" data-date="04.09.2025" data-time="09:10 ‚Üí 14:05" data-dist="420 –∫–º" data-price="480"
             data-photos="https://images.unsplash.com/photo-1503376780353-7e6692767b70?w=600,https://images.unsplash.com/photo-1517170655190-2d5f6d25b2c2?w=600,https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?w=600">
          <div class="r-top">
            <div>
              <div class="r-route">–õ—å–≤–æ–≤ ‚Üí –ñ–∏—Ç–æ–º–∏—Ä</div>
              <div class="sub">04.09.2025 ‚Ä¢ 420 –∫–º ‚Ä¢ 5—á</div>
            </div>
            <span class="badge price">480 ‚Ç¥</span>
          </div>
        </div>

        <div class="r-card hist"
             data-from="–î–Ω–µ–ø—Ä" data-to="–ö–∏–µ–≤" data-date="27.08.2025" data-time="07:20 ‚Üí 12:10" data-dist="480 –∫–º" data-price="630"
             data-photos="https://images.unsplash.com/photo-1619767886558-c2b2e6d6c9f0?w=600,https://images.unsplash.com/photo-1617788138017-80ad91f1860d?w=600,https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=600">
          <div class="r-top">
            <div>
              <div class="r-route">–î–Ω–µ–ø—Ä ‚Üí –ö–∏–µ–≤</div>
              <div class="sub">27.08.2025 ‚Ä¢ 480 –∫–º ‚Ä¢ 5—á</div>
            </div>
            <span class="badge price">630 ‚Ç¥</span>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
  <nav class="bottom-shell" id="nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="bottom-bar">
      <a class="bn-tab" href="passenger-profile.html"><div class="ico">üë§</div>–ü—Ä–æ—Ñ–∏–ª—å</a>
      <a class="bn-tab" href="passenger-wallet.html"><div class="ico">üí≥</div>–ö–æ—à–µ–ª—ë–∫</a>
      <a class="bn-tab active" href="passenger-active.html"><div class="ico">üöó</div>–ê–∫—Ç—É–∞–ª—å–Ω–∞—è</a>
      <a class="bn-tab" href="passenger-search.html"><div class="ico">üîç</div>–ü–æ–∏—Å–∫</a>
    </div>
  </nav>

  <!-- –®–¢–û–†–ö–ê –ò–°–¢–û–†–ò–ò -->
  <div class="sheet" id="sheet" aria-hidden="true">
    <div class="grip"></div>
    <div class="body">
      <div class="d-card">
        <div class="d-top">
          <div class="d-title" id="sTitle">‚Äî</div>
          <button class="close" id="sClose">‚úï</button>
        </div>
        <div class="d-row"><span>‚è∞ <span id="sTime"></span></span><span>üõ£Ô∏è <span id="sDist"></span></span><span>üìÖ <span id="sDate"></span></span></div>
        <div class="photos" id="sPhotos"></div>
      </div>
    </div>
  </div>

  <script>
    // –≤—ã—Å–æ—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -> CSS var(--nav-h)
    (function setNavHeight(){
      const nav = document.getElementById('nav');
      const apply = ()=> document.documentElement.style.setProperty('--nav-h', (nav?.offsetHeight||92) + 'px');
      apply(); addEventListener('resize', apply);
    })();

    // ===== –¢–µ–∫—É—â–∞—è –±—Ä–æ–Ω—å: —á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç—É—Å –∏ –Ω–∞–≤–æ–¥–∏–º –ø–æ—Ä—è–¥–æ–∫ =====
    (function currentBooking(){
      const PAGES = {
        pending:  'passenger-trip-pending.html',
        confirmed:'passenger-trip-live.html',
        enroute:  'passenger-trip-ongoing.html',
        cancelled:'passenger-trip-cancelled.html',
        finished: 'passenger-receipt.html'
      };
      const keyTrip = 'rn:trip:current';
      const card   = document.getElementById('currentCard');
      const empty  = document.getElementById('emptyState');

      const routeText = document.getElementById('routeText');
      const timeText  = document.getElementById('timeText');
      const distText  = document.getElementById('distText');
      const dateText  = document.getElementById('dateText');
      const priceBadge= document.getElementById('priceBadge');
      const statusBadge= document.getElementById('statusBadge');

      function read(k){ try{return JSON.parse(localStorage.getItem(k)||'null');}catch{return null} }
      function pad(n){ return String(n).padStart(2,'0'); }
      function fmtTime(ts){
        const d=new Date(ts); return pad(d.getHours())+':'+pad(d.getMinutes());
      }
      function fmtDate(ts){
        const d=new Date(ts); return pad(d.getDate())+'.'+pad(d.getMonth()+1)+'.'+d.getFullYear();
      }

      const t = read(keyTrip);
      if (!t){
        // –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –±—Ä–æ–Ω–∏ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        card.style.display='none';
        empty.style.display='block';
        return;
      }

      // –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
      const from = t.from || '–ö–∏–µ–≤';
      const to   = t.to   || '–û–¥–µ—Å—Å–∞';
      routeText.textContent = `${from} ‚Üí ${to}`;

      const startAt = t.startAt || (Date.now()+30*60*1000);
      const etaAt   = t.etaAt   || (Date.now()+5*60*60*1000);
      timeText.textContent = `${fmtTime(startAt)} ‚Üí ${fmtTime(etaAt)}`;
      dateText.textContent = t.date || fmtDate(startAt);
      if (t.distanceKm) distText.textContent = `${t.distanceKm} –∫–º`;
      if (t.price) priceBadge.textContent = `${t.price} ‚Ç¥`;

      // —Å—Ç–∞—Ç—É—Å ‚Üí –±–µ–π–¥–∂ + —Å—Å—ã–ª–∫–∞
      const status = t.status || 'pending';
      let badgeText = '–û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ', badgeClass = 'pending';
      if (status==='confirmed'){ badgeText='–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞'; badgeClass='ok'; }
      if (status==='enroute'){   badgeText='–í –ø—É—Ç–∏';        badgeClass='warn'; }
      if (status==='cancelled'){ badgeText='–û—Ç–º–µ–Ω–µ–Ω–∞';      badgeClass='err'; }
      if (status==='finished'){  badgeText='–ó–∞–≤–µ—Ä—à–µ–Ω–∞';     badgeClass='ok'; }

      statusBadge.textContent = badgeText;
      statusBadge.className = 'badge ' + (badgeClass||'pending');

      const target = PAGES[status] || PAGES.pending;
      card.setAttribute('href', target + (t.tripId ? `?tripId=${encodeURIComponent(t.tripId)}` : ''));

      // –µ—Å–ª–∏ –±—Ä–æ–Ω—å –æ—Ç–º–µ–Ω–µ–Ω–∞/–∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Äî –ø—É—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–∫—Ä–∞–Ω
    })();

    // –ò—Å—Ç–æ—Ä–∏—è ‚Üí –æ—Ç–∫—Ä—ã—Ç—å —à—Ç–æ—Ä–∫—É –∏ –ø–æ–∫–∞–∑–∞—Ç—å 3 —Ñ–æ—Ç–æ
    (function historySheet(){
      const sheet = document.getElementById('sheet');
      const sClose = document.getElementById('sClose');

      function openHistory(card){
        const from = card.dataset.from, to = card.dataset.to;
        document.getElementById('sTitle').textContent = `${from} ‚Üí ${to}`;
        document.getElementById('sTime').textContent  = card.dataset.time;
        document.getElementById('sDist').textContent  = card.dataset.dist;
        document.getElementById('sDate').textContent  = card.dataset.date;

        const wrap = document.getElementById('sPhotos');
        wrap.innerHTML = '';
        (card.dataset.photos||'').split(',').slice(0,3).forEach(url=>{
          const d=document.createElement('div'); d.className='ph';
          const img=new Image(); img.src=url.trim(); img.alt=''; img.loading='lazy'; img.decoding='async';
          d.appendChild(img); wrap.appendChild(d);
        });

        sheet.classList.add('open'); sheet.setAttribute('aria-hidden','false');
      }
      function closeHistory(){ sheet.classList.remove('open'); sheet.setAttribute('aria-hidden','true'); }

      document.querySelectorAll('.history .hist').forEach(el=>{
        el.addEventListener('click', ()=> openHistory(el));
      });
      sClose.addEventListener('click', closeHistory);
      sheet.addEventListener('click', e=>{ if(e.target===sheet) closeHistory(); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeHistory(); });
    })();
  </script>
</body>
</html>

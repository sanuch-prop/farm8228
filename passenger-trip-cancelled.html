<!-- passenger-trip-cancelled.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<title>–ü–æ–µ–∑–¥–∫–∞ –≤ –ø—É—Ç–∏ ‚Äî RideNow</title>
<style>
  :root{--ink:#eaf2ff;--muted:#a6b5cc;--stroke:rgba(255,255,255,.18);--glass-1:rgba(14,21,26,.55);--glass-2:rgba(14,21,26,.35);--g1:#ffb668;--g2:#9de9d7;--gutter:16px}
  *{box-sizing:border-box}
  html,body{height:100dvh;margin:0;overflow:hidden;-webkit-text-size-adjust:100%}
  body{
    color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,rgba(0,0,0,.65),rgba(0,0,0,.55) 35%,rgba(0,0,0,.45) 60%,rgba(0,0,0,.55)),url("image.png") center/cover fixed;
    display:grid;grid-template-rows:1fr auto;padding:var(--gutter)
  }
  main{display:grid;place-items:center}
  .panel{width:min(760px,calc(100vw - var(--gutter)*2));border:1px solid var(--stroke);border-radius:22px;
    background:linear-gradient(180deg,var(--glass-1),var(--glass-2));box-shadow:0 30px 80px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,255,255,.22);
    padding:16px;text-align:center;backdrop-filter:blur(14px) saturate(140%)}
  h2{margin:0 0 10px}
  .trip{border:1px solid var(--stroke);border-radius:12px;padding:10px;margin:6px 0 10px;opacity:.95}
  .badge{display:inline-grid;place-items:center;padding:8px 12px;border-radius:14px;font-weight:900;color:#072e12;background:linear-gradient(90deg,#ffb668,#9de9d7)}
  .note{color:#cfe3ff;font-weight:800;margin-top:10px}
  .cta{margin-top:14px;height:52px;border:0;border-radius:14px;cursor:pointer;font-weight:900;font-size:18px;color:#0b0f12;
    background:linear-gradient(90deg,var(--g1),var(--g2));box-shadow:0 10px 24px rgba(183,167,255,.25);width:100%}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
  /* bottom nav */
  .bottom{padding:0 env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
  .bar{display:flex;justify-content:space-around;background:var(--glass-2);border-radius:20px 20px 0 0;padding:8px;backdrop-filter:blur(12px)}
  .tab{flex:1;text-align:center;color:var(--ink);font-size:12px;text-decoration:none;padding:6px 0}
  .tab .ico{font-size:18px;display:block}
  .tab.active{color:var(--g1)}
</style>
</head>
<body>
  <main>
    <div class="panel" id="panel">
      <h2 id="title">–ë—Ä–æ–Ω—å –æ—Ç–º–µ–Ω–µ–Ω–∞</h2>
      <div class="trip" id="trip">–ö–∏–µ–≤ ‚Äî –û–¥–µ—Å—Å–∞ ‚Ä¢ 16.09.2025</div>

      <div class="badge">–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä 25 ‚Ç¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω</div>
      <div class="note" id="reasonText">–ú—ã –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Äî –±—Ä–æ–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω–µ–Ω–∞.</div>
      <div class="note">–ö—Ä–µ–¥–∏—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –∫ –≤–∞—à–µ–π —Å–ª–µ–¥—É—é—â–µ–π –±—Ä–æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>

      <div class="row">
        <button class="cta" onclick="location.href='passenger-search.html'">–ò—Å–∫–∞—Ç—å –Ω–æ–≤—É—é –ø–æ–µ–∑–¥–∫—É</button>
        <button class="cta" onclick="location.href='passenger-wallet.html'">–í ¬´–ö–æ—à–µ–ª—ë–∫¬ª</button>
      </div>
    </div>
  </main>

  <nav class="bottom" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="bar">
      <a class="tab" href="passenger-profile.html"><div class="ico">üë§</div>–ü—Ä–æ—Ñ–∏–ª—å</a>
      <a class="tab" href="passenger-wallet.html"><div class="ico">üí≥</div>–ö–æ—à–µ–ª—ë–∫</a>
      <a class="tab active" href="passenger-active.html"><div class="ico">üöó</div>–ê–∫—Ç—É–∞–ª—å–Ω–∞—è</a>
      <a class="tab" href="passenger-search.html"><div class="ico">üîç</div>–ü–æ–∏—Å–∫</a>
    </div>
  </nav>

<script>
  // ====== —Ä–∞–∑–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ======
  const qs = new URLSearchParams(location.search);
  const tripId = qs.get('tripId') || 'kyiv-odesa';
  const route  = qs.get('route')  || '–ö–∏–µ–≤ ‚Äî –û–¥–µ—Å—Å–∞';
  const date   = qs.get('date')   || '16.09.2025';
  const reason = qs.get('reason') || 'timeout'; // 'timeout' | 'driver' | 'manual'

  // ====== –µ–¥–∏–Ω–æ—Ä–∞–∑–æ–≤—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∫—Ä–µ–¥–∏—Ç–∞ 25 ‚Ç¥ ======
  const VOUCHER_KEY = 'rn:svcfee:voucher';
  const REFUND_FLAG = `rn:svcfee:refund:${tripId}`; // —á—Ç–æ–±—ã –Ω–µ –∑–∞–¥–≤–æ–∏—Ç—å –Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ

  if (!localStorage.getItem(REFUND_FLAG)) {
    let v;
    try { v = JSON.parse(localStorage.getItem(VOUCHER_KEY) || 'null'); } catch(e) { v = null; }
    if (!v) v = { amount:0, used:false };

    // —Å–Ω–∏–º–∞–µ–º –ª—é–±—ã–µ –ª–æ–∫–∏ —Å –≤–∞—É—á–µ—Ä–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 25
    delete v.lockedForTripId; delete v.lockedAt; delete v.lockTtlMs;
    v.amount = Number(v.amount||0) + 25;
    v.used   = false;
    v.lastCreditTripId = tripId;
    v.creditedAt = Date.now();

    localStorage.setItem(VOUCHER_KEY, JSON.stringify(v));
    localStorage.setItem(REFUND_FLAG, '1');
  }

  // ====== –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ ======
  document.getElementById('trip').textContent = `${route} ‚Ä¢ ${date}`;
  const reasonText = {
    timeout: '–ú—ã –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Äî –±—Ä–æ–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω–µ–Ω–∞.',
    driver:  '–í–æ–¥–∏—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –ø–æ–µ–∑–¥–∫—É. –ü—Ä–∏–Ω–æ—Å–∏–º –∏–∑–≤–∏–Ω–µ–Ω–∏—è –∑–∞ –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞.',
    manual:  '–ë—Ä–æ–Ω—å –æ—Ç–º–µ–Ω–µ–Ω–∞. –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä —Å–æ—Ö—Ä–∞–Ω—ë–Ω –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –±—Ä–æ–Ω–∏.'
  }[reason] || reasonText.timeout;
  document.getElementById('reasonText').textContent = reasonText;
</script>
</body>
</html>
